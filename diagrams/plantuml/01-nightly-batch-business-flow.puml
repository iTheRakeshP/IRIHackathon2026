@startuml
title Nightly AI Batch - Business Process Flow

!define PRIMARY_BLUE #1E40AF
!define SECONDARY_TEAL #0891B2
!define BG_LIGHT #F8FAFC
!define SURFACE_WHITE #FFFFFF
!define BORDER_DARK #334155
!define TEXT_DARK #0F172A
!define ACCENT_PURPLE #7C3AED
!define SEVERITY_HIGH #DC2626
!define SEVERITY_MEDIUM #F59E0B
!define SEVERITY_LOW #10B981

skinparam backgroundColor BG_LIGHT
skinparam shadowing true
skinparam roundcorner 15
skinparam defaultFontName Segoe UI
skinparam defaultFontSize 12
skinparam defaultFontStyle bold
skinparam ArrowColor BORDER_DARK
skinparam ArrowThickness 2
skinparam activity {
  BackgroundColor SURFACE_WHITE
  BorderColor PRIMARY_BLUE
  BorderThickness 2
  FontColor TEXT_DARK
  DiamondBackgroundColor #E0E7FF
  DiamondBorderColor PRIMARY_BLUE
  DiamondFontColor TEXT_DARK
  StartColor PRIMARY_BLUE
  EndColor SECONDARY_TEAL
}

start

partition "Batch Scheduler" #DBEFFE {
  :#DBEFFE;Trigger nightly run\n(batch_alert_generator.py);
}

partition "Data Inputs" #E0F2FE {
  :#E0F2FE;Load client profiles\n(clients_profile.json);
  :#E0F2FE;Load in-force policies\n(policies.json);
  :#E0F2FE;Load product catalog\n(products.json);
}

partition "Policy-by-Policy Analysis" #F1F5F9 {
  :#F1F5F9;For each policy + linked client;

  if (Replacement trigger met?) then (Yes)
    :#FEE2E2;Score replacement opportunity\n(Performance 40 + Suitability 30 + Cost 20 + Features 10);
    :#FCA5A5;Create REPLACEMENT alert;
  endif

  if (Income activation trigger met?) then (Yes)
    :#FEF3C7;Score activation timing\n(urgency + deferral tradeoff);
    :#FCD34D;Create INCOME_ACTIVATION alert;
  endif

  if (Suitability drift trigger met?) then (Yes)
    :#D1FAE5;Score drift\n(Risk 35 + Objective 30 + Financial 20 + Horizon 15);
    :#6EE7B7;Create SUITABILITY_DRIFT alert;
  endif

  if (Missing info trigger met?) then (Yes)
    :#FDEDD3;Score admin data quality\n(Completeness 40 + Recency 30 + Regulatory 20 + DTCC 10);
    :#FDBA74;Create MISSING_INFO alert;
  endif

  :#E0E7FF;Attach generated alerts to policy;
}

partition "Batch Output" #EDE9FE {
  :#EDE9FE;Write enriched policies to\nalerts_generated.json;
  :#EDE9FE;Preserve original policies.json;
}

partition "Daytime Consumption" #CFFAFE {
  :#CFFAFE;FastAPI data store reads\nalerts_generated.json;
  :#CFFAFE;Dashboard and modal show alerts\nwith AI analysis metadata;
}

stop
@enduml
