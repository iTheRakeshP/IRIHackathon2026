<div class="rounded-xl border border-slate-200 bg-white p-6">
  @if (!verified()) {
    <div class="mb-6 flex gap-3 rounded-lg bg-indigo-50 px-5 py-4">
      <mat-icon class="flex-shrink-0 text-indigo-600 !text-2xl !w-6 !h-6">info</mat-icon>
      <div class="flex-1">
        <strong class="mb-1.5 block text-sm text-indigo-700">Review Current Suitability Profile</strong>
        <p class="m-0 text-sm leading-relaxed text-slate-700">Verify the client's current suitability information below. Make any necessary updates before proceeding to alternatives.</p>
      </div>
    </div>

    <!-- Read-Only View -->
    @if (!editMode()) {
      <div>
        <div class="mb-6 grid grid-cols-[repeat(auto-fit,minmax(200px,1fr))] gap-5">
          <div class="flex flex-col gap-1.5 rounded-lg border border-slate-200 bg-slate-50 p-3.5">
            <span class="text-xs font-semibold uppercase tracking-wider text-slate-400">Risk Tolerance</span>
            <span class="text-[15px] font-medium text-slate-700">{{ formData.riskTolerance || 'Not Set' }}</span>
          </div>

          <div class="flex flex-col gap-1.5 rounded-lg border border-slate-200 bg-slate-50 p-3.5">
            <span class="text-xs font-semibold uppercase tracking-wider text-slate-400">Primary Objective</span>
            <span class="text-[15px] font-medium text-slate-700">{{ formData.primaryObjective || 'Not Set' }}</span>
          </div>

          <div class="flex flex-col gap-1.5 rounded-lg border border-slate-200 bg-slate-50 p-3.5">
            <span class="text-xs font-semibold uppercase tracking-wider text-slate-400">Secondary Objective</span>
            <span class="text-[15px] font-medium text-slate-700">{{ formData.secondaryObjective || 'Not Set' }}</span>
          </div>

          <div class="flex flex-col gap-1.5 rounded-lg border border-slate-200 bg-slate-50 p-3.5">
            <span class="text-xs font-semibold uppercase tracking-wider text-slate-400">Current Income Need</span>
            <span class="text-[15px] font-medium text-slate-700">{{ formData.currentIncomeNeed || 'Not Set' }}</span>
          </div>

          <div class="flex flex-col gap-1.5 rounded-lg border border-slate-200 bg-slate-50 p-3.5">
            <span class="text-xs font-semibold uppercase tracking-wider text-slate-400">Life Stage</span>
            <span class="text-[15px] font-medium text-slate-700">{{ formData.lifeStage || 'Not Set' }}</span>
          </div>

          <div class="flex flex-col gap-1.5 rounded-lg border border-slate-200 bg-slate-50 p-3.5">
            <span class="text-xs font-semibold uppercase tracking-wider text-slate-400">Liquidity Importance</span>
            <span class="text-[15px] font-medium text-slate-700">{{ formData.liquidityImportance || 'Not Set' }}</span>
          </div>
        </div>

        <div class="flex justify-end gap-3 border-t border-slate-200 pt-4">
          <button mat-button (click)="onEdit()">
            <mat-icon>edit</mat-icon>
            Update Suitability
          </button>
          <button mat-raised-button color="primary" (click)="onVerifyWithoutChanges()">
            <mat-icon>check_circle</mat-icon>
            Verify & Continue
          </button>
        </div>
      </div>
    }

    <!-- Edit Mode -->
    @if (editMode()) {
      <div>
        <div class="mb-6 flex items-center gap-2 rounded-lg bg-amber-50 px-4 py-3 font-medium text-orange-700">
          <mat-icon class="!text-xl !w-5 !h-5">edit_note</mat-icon>
          <span>Editing Suitability Profile</span>
        </div>

        <form class="suitability-form">
          <div class="mb-6 grid grid-cols-[repeat(auto-fit,minmax(250px,1fr))] gap-4">
            <!-- Risk Tolerance -->
            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Risk Tolerance</mat-label>
              <mat-select [(ngModel)]="formData.riskTolerance" name="riskTolerance" required>
                @for (option of riskToleranceOptions; track option) {
                  <mat-option [value]="option">{{ option }}</mat-option>
                }
              </mat-select>
              <mat-icon matPrefix class="!text-indigo-600">trending_up</mat-icon>
            </mat-form-field>

            <!-- Primary Objective -->
            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Primary Objective</mat-label>
              <mat-select [(ngModel)]="formData.primaryObjective" name="primaryObjective" required>
                @for (option of objectiveOptions; track option) {
                  <mat-option [value]="option">{{ option }}</mat-option>
                }
              </mat-select>
              <mat-icon matPrefix class="!text-indigo-600">flag</mat-icon>
            </mat-form-field>

            <!-- Secondary Objective -->
            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Secondary Objective</mat-label>
              <mat-select [(ngModel)]="formData.secondaryObjective" name="secondaryObjective">
                @for (option of objectiveOptions; track option) {
                  <mat-option [value]="option">{{ option }}</mat-option>
                }
              </mat-select>
              <mat-icon matPrefix class="!text-indigo-600">assistant_photo</mat-icon>
            </mat-form-field>

            <!-- Current Income Need -->
            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Current Income Need</mat-label>
              <mat-select [(ngModel)]="formData.currentIncomeNeed" name="currentIncomeNeed" required>
                @for (option of incomeNeedOptions; track option) {
                  <mat-option [value]="option">{{ option }}</mat-option>
                }
              </mat-select>
              <mat-icon matPrefix class="!text-indigo-600">payments</mat-icon>
            </mat-form-field>

            <!-- Life Stage -->
            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Life Stage</mat-label>
              <mat-select [(ngModel)]="formData.lifeStage" name="lifeStage" required>
                @for (option of lifeStageOptions; track option) {
                  <mat-option [value]="option">{{ option }}</mat-option>
                }
              </mat-select>
              <mat-icon matPrefix class="!text-indigo-600">timeline</mat-icon>
            </mat-form-field>

            <!-- Liquidity Importance -->
            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Liquidity Importance</mat-label>
              <mat-select [(ngModel)]="formData.liquidityImportance" name="liquidityImportance" required>
                @for (option of liquidityOptions; track option) {
                  <mat-option [value]="option">{{ option }}</mat-option>
                }
              </mat-select>
              <mat-icon matPrefix class="!text-indigo-600">water_drop</mat-icon>
            </mat-form-field>
          </div>

          <div class="flex justify-end gap-3 border-t border-slate-200 pt-4">
            <button mat-button (click)="onCancel()" [disabled]="saving()" type="button">
              <mat-icon>close</mat-icon>
              Cancel
            </button>
            <button 
              mat-raised-button 
              color="primary" 
              (click)="onSave()" 
              [disabled]="saving() || !hasChanges()"
              type="button">
              <ng-container>
                @if (saving()) {
                  <mat-icon class="animate-spin">sync</mat-icon>
                  <span>Saving...</span>
                } @else {
                  <mat-icon>save</mat-icon>
                  <span>Save & Verify</span>
                }
              </ng-container>
            </button>
          </div>
        </form>
      </div>
    }
  } @else {
    <!-- Verified State -->
    <div class="px-5 py-10 text-center">
      <div class="mb-4">
        <mat-icon class="text-green-500 !text-[64px] !w-16 !h-16">check_circle</mat-icon>
      </div>
      <h4 class="m-0 mb-2 text-xl font-semibold text-green-700">Suitability Verified</h4>
      <p class="m-0 mb-2 text-sm text-slate-500">Client suitability profile has been reviewed and verified.</p>
      @if (client?.suitability?.lastUpdated) {
        <p class="mb-5 text-[13px] text-slate-400">
          Verified: {{ client.suitability!.lastUpdated | date: 'MMM dd, yyyy h:mm a' }}
        </p>
      }
      <div class="flex flex-wrap justify-center gap-2">
        <mat-chip class="!bg-green-50 !text-green-700 !text-[13px]">{{ formData.riskTolerance }}</mat-chip>
        <mat-chip class="!bg-green-50 !text-green-700 !text-[13px]">{{ formData.primaryObjective }}</mat-chip>
        <mat-chip class="!bg-green-50 !text-green-700 !text-[13px]">{{ formData.lifeStage }}</mat-chip>
      </div>
    </div>
  }
</div>
