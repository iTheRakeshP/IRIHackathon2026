<div class="overflow-hidden rounded-xl bg-white shadow-md">
  <div class="flex items-start justify-between bg-gradient-to-br from-amber-500 to-orange-600 px-6 py-5 text-white">
    <div class="flex items-start gap-4">
      <mat-icon class="text-white !text-[32px] !w-8 !h-8">info</mat-icon>
      <div>
        <h3 class="m-0 mb-1 text-xl font-semibold">{{ alert.title }}</h3>
        <p class="m-0 text-sm opacity-90">{{ alert.reasonShort }}</p>
      </div>
    </div>
    <button mat-icon-button class="!text-white" (click)="onAskAI()" matTooltip="Ask PolicyPilot">
      <mat-icon>psychology</mat-icon>
    </button>
  </div>

  <mat-divider></mat-divider>

  <div>
    <!-- What Changed -->
    <section class="bg-amber-50/50 px-8 py-6">
      <h4 class="mb-5 flex items-center gap-2 text-base font-semibold text-slate-800">
        <mat-icon class="text-indigo-600 !text-xl !w-5 !h-5">compare_arrows</mat-icon>
        What Changed
      </h4>

      <div class="flex flex-col gap-4">
        @for (item of driftItems; track item.category) {
          <div class="rounded-lg border-l-4 bg-white px-5 py-4"
               [ngClass]="getImpactClass(item.impact) === 'impact-high' ? 'border-red-500' : getImpactClass(item.impact) === 'impact-medium' ? 'border-orange-500' : 'border-green-500'">
            <div class="mb-3 flex items-center justify-between">
              <h5 class="m-0 text-base font-semibold text-slate-800">{{ item.category }}</h5>
              <span class="rounded-xl px-3 py-1 text-[11px] font-semibold uppercase tracking-wider"
                    [ngClass]="getImpactClass(item.impact) === 'impact-high' ? 'bg-red-50 text-red-700' : getImpactClass(item.impact) === 'impact-medium' ? 'bg-orange-50 text-orange-700' : 'bg-green-50 text-green-700'">
                {{ getImpactLabel(item.impact) }}
              </span>
            </div>
            <div class="flex items-center gap-4">
              <div class="flex flex-1 flex-col gap-1 rounded-lg bg-slate-100 p-3">
                <span class="text-[11px] font-semibold uppercase tracking-wider text-slate-400">Previous</span>
                <span class="text-[15px] text-slate-500">{{ item.previous }}</span>
              </div>
              <mat-icon class="flex-shrink-0 text-indigo-600 !text-2xl !w-6 !h-6">arrow_forward</mat-icon>
              <div class="flex flex-1 flex-col gap-1 rounded-lg bg-indigo-50 p-3">
                <span class="text-[11px] font-semibold uppercase tracking-wider text-indigo-700">Current</span>
                <span class="text-[15px] font-semibold text-indigo-600">{{ item.current }}</span>
              </div>
            </div>
          </div>
        }
      </div>
    </section>

    <mat-divider></mat-divider>

    <!-- Why This Matters -->
    <section class="px-8 py-6">
      <h4 class="mb-5 flex items-center gap-2 text-base font-semibold text-slate-800">
        <mat-icon class="text-indigo-600 !text-xl !w-5 !h-5">lightbulb</mat-icon>
        Why This Review Is Appropriate
      </h4>

      <div class="flex flex-col gap-4">
        <div class="flex gap-4 rounded-lg bg-slate-50 p-4">
          <mat-icon class="flex-shrink-0 text-indigo-600 !text-[28px] !w-7 !h-7">gavel</mat-icon>
          <div>
            <strong class="mb-1.5 block text-[15px] text-slate-800">Regulatory Requirement</strong>
            <p class="m-0 text-sm leading-relaxed text-slate-500">
              Material changes to a client's financial situation, objectives, or risk profile 
              require a suitability review to ensure current holdings remain appropriate 
              (FINRA Rule 2111, Reg BI).
            </p>
          </div>
        </div>

        <div class="flex gap-4 rounded-lg bg-slate-50 p-4">
          <mat-icon class="flex-shrink-0 text-indigo-600 !text-[28px] !w-7 !h-7">verified_user</mat-icon>
          <div>
            <strong class="mb-1.5 block text-[15px] text-slate-800">Best Interest Obligation</strong>
            <p class="m-0 text-sm leading-relaxed text-slate-500">
              The shift from growth to income objectives suggests the client's needs have evolved. 
              This review ensures the current product features align with updated goals.
            </p>
          </div>
        </div>

        <div class="flex gap-4 rounded-lg bg-slate-50 p-4">
          <mat-icon class="flex-shrink-0 text-indigo-600 !text-[28px] !w-7 !h-7">analytics</mat-icon>
          <div>
            <strong class="mb-1.5 block text-[15px] text-slate-800">Product Alignment</strong>
            <p class="m-0 text-sm leading-relaxed text-slate-500">
              The current policy was selected based on previous suitability factors. 
              Confirming it still matches updated objectives helps prevent misalignment.
            </p>
          </div>
        </div>
      </div>
    </section>

    <mat-divider></mat-divider>

    <!-- Review Guidance -->
    <section class="bg-slate-50/60 px-8 py-6">
      <h4 class="mb-5 flex items-center gap-2 text-base font-semibold text-slate-800">
        <mat-icon class="text-indigo-600 !text-xl !w-5 !h-5">checklist</mat-icon>
        Review Guidance
      </h4>

      <div class="flex flex-col gap-4">
        <div class="flex items-start gap-4">
          <div class="flex h-9 w-9 flex-shrink-0 items-center justify-center rounded-full bg-indigo-600 text-base font-semibold text-white">1</div>
          <div class="pt-1">
            <strong class="mb-1 block text-[15px] text-slate-800">Confirm Changes</strong>
            <p class="m-0 text-sm leading-relaxed text-slate-500">Discuss detected changes with client and verify accuracy.</p>
          </div>
        </div>

        <div class="flex items-start gap-4">
          <div class="flex h-9 w-9 flex-shrink-0 items-center justify-center rounded-full bg-indigo-600 text-base font-semibold text-white">2</div>
          <div class="pt-1">
            <strong class="mb-1 block text-[15px] text-slate-800">Assess Current Product</strong>
            <p class="m-0 text-sm leading-relaxed text-slate-500">Evaluate whether existing policy features meet updated needs (e.g., income riders for income objective).</p>
          </div>
        </div>

        <div class="flex items-start gap-4">
          <div class="flex h-9 w-9 flex-shrink-0 items-center justify-center rounded-full bg-indigo-600 text-base font-semibold text-white">3</div>
          <div class="pt-1">
            <strong class="mb-1 block text-[15px] text-slate-800">Document Findings</strong>
            <p class="m-0 text-sm leading-relaxed text-slate-500">Record review outcome and any recommended actions or affirmations.</p>
          </div>
        </div>

        <div class="flex items-start gap-4">
          <div class="flex h-9 w-9 flex-shrink-0 items-center justify-center rounded-full bg-indigo-600 text-base font-semibold text-white">4</div>
          <div class="pt-1">
            <strong class="mb-1 block text-[15px] text-slate-800">Consider Alternatives</strong>
            <p class="m-0 text-sm leading-relaxed text-slate-500">If current policy no longer aligns, consider whether alternatives better serve client needs.</p>
          </div>
        </div>
      </div>
    </section>

    <mat-divider></mat-divider>

    <!-- Neutral Considerations -->
    <section class="px-8 py-6">
      <h4 class="mb-5 flex items-center gap-2 text-base font-semibold text-slate-800">
        <mat-icon class="text-indigo-600 !text-xl !w-5 !h-5">psychology</mat-icon>
        Key Considerations
      </h4>

      <div class="grid grid-cols-[repeat(auto-fit,minmax(250px,1fr))] gap-4">
        <div class="rounded-lg border border-slate-200 bg-white p-5 transition-all duration-200 hover:border-indigo-500 hover:shadow-md">
          <mat-icon class="mb-3 text-indigo-600 !text-[32px] !w-8 !h-8">question_mark</mat-icon>
          <h5 class="m-0 mb-2 text-[15px] font-semibold text-slate-800">Current Product Features</h5>
          <p class="m-0 text-[13px] leading-relaxed text-slate-500">Does the existing policy have features that align with income objectives (e.g., income riders, guaranteed withdrawals)?</p>
        </div>

        <div class="rounded-lg border border-slate-200 bg-white p-5 transition-all duration-200 hover:border-indigo-500 hover:shadow-md">
          <mat-icon class="mb-3 text-indigo-600 !text-[32px] !w-8 !h-8">timeline</mat-icon>
          <h5 class="m-0 mb-2 text-[15px] font-semibold text-slate-800">Time Horizon</h5>
          <p class="m-0 text-[13px] leading-relaxed text-slate-500">When does the client anticipate needing income? Does the policy support their timing requirements?</p>
        </div>

        <div class="rounded-lg border border-slate-200 bg-white p-5 transition-all duration-200 hover:border-indigo-500 hover:shadow-md">
          <mat-icon class="mb-3 text-indigo-600 !text-[32px] !w-8 !h-8">account_balance</mat-icon>
          <h5 class="m-0 mb-2 text-[15px] font-semibold text-slate-800">Overall Portfolio</h5>
          <p class="m-0 text-[13px] leading-relaxed text-slate-500">How does this annuity fit within the client's broader retirement income strategy?</p>
        </div>

        <div class="rounded-lg border border-slate-200 bg-white p-5 transition-all duration-200 hover:border-indigo-500 hover:shadow-md">
          <mat-icon class="mb-3 text-indigo-600 !text-[32px] !w-8 !h-8">swap_horiz</mat-icon>
          <h5 class="m-0 mb-2 text-[15px] font-semibold text-slate-800">Change Costs</h5>
          <p class="m-0 text-[13px] leading-relaxed text-slate-500">If a change is contemplated, what are the costs (surrender charges, taxes, lost benefits)?</p>
        </div>
      </div>
    </section>

    <!-- Actions -->
    <div class="flex justify-end gap-3 border-t border-slate-200 px-8 py-6">
      <button mat-button (click)="onAskAI()">
        <mat-icon>psychology</mat-icon>
        Explain Rationale
      </button>
      <button mat-button (click)="onMarkReviewed()">
        <mat-icon>check</mat-icon>
        Mark Reviewed
      </button>
      <button mat-raised-button color="primary" (click)="onSaveNote()">
        <mat-icon>save</mat-icon>
        Save Review Note
      </button>
    </div>
  </div>
</div>
